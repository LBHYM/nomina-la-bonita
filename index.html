<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Nómina | La Bonita</title>
    <link rel="icon" href="./logo.png" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;800&display=swap" rel="stylesheet">
  <style>
/* La Bonita — Nómina (GitHub Pages) */
:root{
  --brown:#5A3B2E;
  --caramel:#C48A5A;
  --mint:#4DAA96;
  --lime:#A9C93B;
  --blush:#D77B86;
  --sand:#F6F0E7;
  --bg:#fbfaf8;
  --card:#ffffff;
  --text:#231b16;
  --muted:#6b5b52;
  --border:rgba(90,59,46,.14);
  --shadow: 0 14px 35px rgba(0,0,0,.08);
  --radius: 18px;
}

*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0;
  font-family: Nunito, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
  background: radial-gradient(1200px 600px at 20% 0%, rgba(77,170,150,.12), transparent 55%),
              radial-gradient(900px 500px at 85% 10%, rgba(215,123,134,.12), transparent 55%),
              radial-gradient(900px 500px at 60% 90%, rgba(196,138,90,.10), transparent 55%),
              var(--bg);
  color:var(--text);
}

.topbar{
  position: sticky;
  top: 0;
  z-index: 20;
  backdrop-filter: blur(10px);
  background: rgba(251,250,248,.78);
  border-bottom: 1px solid var(--border);
  padding: 14px 18px;
  display:flex;
  gap: 14px;
  align-items:center;
  justify-content:space-between;
}

.brand{
  display:flex;
  gap: 12px;
  align-items:center;
  min-width: 260px;
}
.logo{
  width: 52px;
  height: 52px;
  object-fit: contain;
}
.brandName{
  font-weight: 800;
  letter-spacing: .2px;
  font-size: 18px;
  color: var(--brown);
}
.brandSub{
  font-size: 13px;
  color: var(--muted);
}

.topActions{
  display:flex;
  gap:10px;
  flex-wrap: wrap;
  justify-content:flex-end;
}

.wrap{
  max-width: 1200px;
  margin: 18px auto 40px;
  padding: 0 16px;
}

.grid{
  display:grid;
  grid-template-columns: 1fr 1.25fr;
  gap: 14px;
}

@media (max-width: 980px){
  .grid{grid-template-columns:1fr}
  .topbar{position:relative}
}

.card{
  background: var(--card);
  border: 1px solid var(--border);
  border-radius: var(--radius);
  box-shadow: var(--shadow);
  padding: 14px;
}

.cardHead{
  display:flex;
  gap: 10px;
  align-items:center;
  justify-content:space-between;
  margin-bottom: 10px;
}
h2{
  margin:0;
  font-size: 18px;
  color: var(--brown);
  letter-spacing: .2px;
}
.pill{
  font-size: 12px;
  color: var(--brown);
  border: 1px solid var(--border);
  background: rgba(246,240,231,.7);
  padding: 6px 10px;
  border-radius: 999px;
}

.form{
  display:flex;
  flex-direction:column;
  gap: 10px;
}

.row{
  display:flex;
  gap: 10px;
  align-items:flex-end;
}
@media (max-width: 520px){
  .row{flex-direction:column; align-items:stretch}
}

.field{
  display:flex;
  flex-direction:column;
  gap: 6px;
  width: 50%;
}
label{
  font-size: 12px;
  color: var(--muted);
}
input, select{
  height: 40px;
  border-radius: 12px;
  border: 1px solid var(--border);
  padding: 0 12px;
  font-size: 14px;
  outline: none;
  background: white;
}
input:focus, select:focus{
  border-color: rgba(77,170,150,.6);
  box-shadow: 0 0 0 4px rgba(77,170,150,.15);
}

.check{
  display:flex;
  gap: 10px;
  align-items:center;
  border: 1px solid var(--border);
  background: rgba(246,240,231,.55);
  padding: 10px 12px;
  border-radius: 14px;
  width: 50%;
}
.check input{height:auto}
.check span{font-size: 14px; color: var(--brown); font-weight: 700}

.actions{
  align-items:center;
  justify-content:space-between;
}
.preview{
  font-size: 12px;
  color: var(--muted);
  text-align:right;
}
.mini{flex:1}

.btn{
  border: 0;
  border-radius: 14px;
  height: 42px;
  padding: 0 14px;
  font-weight: 800;
  cursor:pointer;
  transition: transform .08s ease, box-shadow .08s ease, opacity .08s ease;
}
.btn:active{transform: translateY(1px)}
.btnPrimary{
  background: linear-gradient(135deg, var(--mint), var(--caramel));
  color: white;
  box-shadow: 0 10px 20px rgba(77,170,150,.22);
}
.btnGhost{
  background: rgba(246,240,231,.7);
  border: 1px solid var(--border);
  color: var(--brown);
}
.btnDanger{
  background: rgba(215,123,134,.18);
  border: 1px solid rgba(215,123,134,.35);
  color: #7a2f3a;
}

.box{
  width: 50%;
  border: 1px solid var(--border);
  background: rgba(246,240,231,.55);
  padding: 12px;
  border-radius: 16px;
}
.boxTitle{
  font-weight: 800;
  color: var(--brown);
  margin-bottom: 6px;
}
.boxText{
  color: var(--muted);
  font-size: 13px;
  line-height: 1.4;
}
.small{font-size: 12px; opacity: .9}

.range{
  font-size: 13px;
  color: var(--brown);
  font-weight: 800;
  padding: 10px 12px;
  border-radius: 14px;
  border: 1px dashed rgba(90,59,46,.22);
  background: rgba(246,240,231,.5);
}

.tableWrap{
  width:100%;
  overflow:auto;
  border-radius: 16px;
  border: 1px solid var(--border);
}
.table{
  width:100%;
  border-collapse: collapse;
  min-width: 900px;
}
.table th, .table td{
  padding: 10px 10px;
  border-bottom: 1px solid rgba(90,59,46,.10);
  font-size: 13px;
}
.table th{
  position: sticky;
  top: 0;
  background: rgba(246,240,231,.9);
  text-align:left;
  color: var(--brown);
  font-weight: 900;
}
.table td{color:#2c231e}
.table tr:hover td{background: rgba(77,170,150,.06)}
.num{text-align:right; font-variant-numeric: tabular-nums;}

.iconBtn{
  border: 1px solid var(--border);
  background: rgba(246,240,231,.7);
  height: 34px;
  padding: 0 10px;
  border-radius: 12px;
  cursor:pointer;
  font-weight: 900;
  color: var(--brown);
}
.iconBtnDanger{
  border-color: rgba(215,123,134,.35);
  background: rgba(215,123,134,.15);
  color: #7a2f3a;
}

.totals{
  display:grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 10px;
  margin-top: 12px;
}
@media (max-width: 980px){
  .totals{grid-template-columns:1fr}
}
.totalCard{
  border: 1px solid var(--border);
  background: rgba(246,240,231,.55);
  padding: 12px;
  border-radius: 16px;
}
.totalCard .k{
  color: var(--muted);
  font-size: 12px;
  font-weight: 800;
}
.totalCard .v{
  color: var(--brown);
  font-size: 22px;
  font-weight: 900;
  margin-top: 6px;
}

.footer{
  display:flex;
  justify-content:space-between;
  gap: 12px;
  padding: 14px 4px 0;
  color: var(--muted);
  font-size: 12px;
}
@media (max-width: 720px){
  .footer{flex-direction:column}
}

.bonosUI{
  display:flex;
  flex-direction:column;
  gap: 8px;
  margin-top: 8px;
}
.bonoRow{
  display:flex;
  gap: 10px;
  align-items:center;
  justify-content:space-between;
}
.bonoRow .name{
  font-weight: 900;
  color: var(--brown);
}
.toggle{
  display:flex;
  gap: 8px;
  align-items:center;
}
.toggle input{transform: scale(1.15)}


.btnWarn{
  background: linear-gradient(135deg, var(--caramel), var(--blush)) !important;
  box-shadow: 0 10px 20px rgba(215,123,134,.20) !important;
}


.note{
  width: 100%;
  padding: 10px 12px;
  border-radius: 14px;
  background: rgba(77,170,150,.10);
  border: 1px solid rgba(77,170,150,.22);
  color: var(--brown);
  font-weight: 800;
  font-size: 13px;
}


.hint{
  margin-top: 6px;
  font-size: 12px;
  font-weight: 800;
  color: rgba(90,59,46,.72);
}

input[type=number]{ width: 100%; }


/* PDF button row */
#btnReciboPDF{
  width: 100%;
}


/* Reglas: mismo tamaño y compacto */
.rules .boxText{
  font-size: 12px;
  font-weight: 800;
  line-height: 1.35;
}
.rules .boxText div{
  font-size: 12px;
  font-weight: 800;
  line-height: 1.35;
  margin: 0 0 4px 0;
}

</style>
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <img src="./logo.png" alt="La Bonita" class="logo" />
      <div class="brandText">
        <div class="brandName">La Bonita</div>
        <div class="brandSub">Helados y más… · Nómina</div>
      </div>
    </div>

    <div class="topActions">
      <button id="btnExportNomina" class="btn btnGhost">Exportar nómina (CSV)</button>
      <button id="btnExportRegistro" class="btn btnGhost">Exportar registro (CSV)</button>
      <button id="btnReset" class="btn btnDanger">Borrar todo</button>
    </div>
  </header>

  <main class="wrap">
    <section class="grid">
      <div class="card">
        <div class="cardHead">
          <h2>Registro diario</h2>
          <span class="pill">Rápido · 1 minuto</span>
        </div>

        <div class="form">
          <div class="row">
            <div class="field">
              <label>Fecha</label>
              <input type="date" id="fecha" />
            </div>
            <div class="field">
              <label>Empleada</label>
              <select id="empleada"></select>
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Hora entrada</label>
              <input type="time" id="entrada" />
            </div>
            <div class="field">
              <label>Hora salida</label>
              <input type="time" id="salida" />
            </div>
          </div>

          <div class="row">
            <div class="field">
              <label>Videos publicados</label>
              <input type="number" id="videos" min="0" step="1" value="0" />
              <div class="hint">Cada video vale $20</div>
            </div>

            <div class="field">
              <label>Playera (costo total)</label>
              <input type="number" id="playeraCosto" min="0" step="1" value="0" placeholder="Ej: 250" />
              <div class="hint">La mitad la paga el empleado. Se descuenta en pagos de $25 por quincena.</div>
            </div>

            <label class="check">
              <input type="checkbox" id="playeraAplicar" />
              <span>Aplicar descuento de playera en esta quincena (-$25)</span>
            </label>

            <div class="note">
              La tardanza se calcula sola con la hora de entrada (después de 4:10 pm).
            </div>
          </div>

          <div class="row">
            <div class="field" style="width:100%">
              <label>Notas (opcional)</label>
              <input type="text" id="notas" placeholder="Ej: entró antes por inventario, se quedó por cierre, etc." />
            </div>
          </div>

          <div class="row actions">
            <button id="btnAdd" class="btn btnPrimary">Guardar registro</button>
            <div class="mini">
              <div id="preview" class="preview"></div>
            </div>
          </div>
        </div>
      </div>

      <div class="card">
        <div class="cardHead">
          <h2>Nómina quincenal</h2>
          <span class="pill">Automática</span>
        </div>

        <div class="form">
          <div class="row">
            <div class="field">
              <label>Mes</label>
              <input type="month" id="mes" />
            </div>

            <div class="field">
              <label>Quincena</label>
              <select id="quincena">
                <option value="1-15">1 al 15</option>
                <option value="16-fin">16 al fin</option>
              </select>
            </div>
          </div>

          <div class="row">
            <div class="box">
              <div class="boxTitle">Reglas</div>
              <div class="boxText">
                <div>• $40 por hora</div>
                <div>• Lunes pagado: 4 horas (automático)</div>
                <div>• Extra por cuartos: 0–14 min no cuenta</div>
                <div>• Hora programada: siempre es :00 o :30</div>
                <div>• Tolerancia: 10 min (tarde si entra 10 min después de su hora programada)</div>
                <div>• Pierde bono si llega tarde más de 3 veces en la quincena</div>
                <div>• Bono puntualidad: variable por quincena</div>
                <div>• Playera: plan (costo total / mitad empleado) y descuento de $25 por quincena</div>
              </div>
                <div>• Lunes pagado: 4 horas (automático)</div>
                <div>• Extra por cuartos: 0–14 min no cuenta</div>
                <div>• Tolerancia: 10 min</div>
                <div>• Pierde bono si llega tarde más de 3 veces en la quincena</div>
                <div>• Bono puntualidad: variable por quincena</div>
                <div>• Playera: plan (costo total / mitad empleado) y descuento de $25 por quincena</div>
              </div>
              </div>
            </div>

            <div class="box">
              <div class="boxTitle">Bono puntualidad (quincena)</div>
              <div class="boxText">
                <div class="small">Lupita siempre sí (automático).</div>
                <div id="bonosUI" class="bonosUI"></div>
              </div>
            </div>
          </div>

          <div class="row">
            <div class="range" id="rangeText"></div>
          </div>

          <div class="row">
            <div class="field">
              <label>Recibo para empleada</label>
              <select id="reciboEmpleado"></select>
            </div>
            <div class="field">
              <label>&nbsp;</label>
              <button id="btnReciboPDF" class="btn btnPrimary">Descargar recibo (PDF)</button>
            </div>
          </div>

        </div>

        <div class="tableWrap">
          <table class="table" id="tablaNomina">
            <thead>
              <tr>
                <th>Empleada</th>
                <th class="num">Horas</th>
                <th class="num">Lunes</th>
                <th class="num">Pago horas</th>
                <th class="num">Videos</th>
                <th class="num">Pago videos</th>
                <th class="num">Playera</th>
                <th class="num">Saldo playera</th>
                <th class="num">Bono</th>
                <th class="num">TOTAL</th>
              </tr>
            </thead>
            <tbody id="nominaBody"></tbody>
          </table>
        </div>

        <div class="totals">
          <div class="totalCard">
            <div class="k">Total nómina</div>
            <div class="v" id="totalNomina">$0.00</div>
          </div>
          <div class="totalCard">
            <div class="k">Total videos</div>
            <div class="v" id="totalVideos">$0.00</div>
          </div>
          <div class="totalCard">
            <div class="k">Descuento playeras</div>
            <div class="v" id="totalPlayeras">$0.00</div>
          </div>
        </div>
      </div>
    </section>

    <section class="card">
      <div class="cardHead">
        <h2>Historial (registros guardados)</h2>
        <span class="pill">Se guarda en tu navegador</span>
      </div>

      <div class="tableWrap">
        <table class="table" id="tablaRegistro">
          <thead>
            <tr>
              <th>Fecha</th>
              <th>Empleada</th>
              <th class="num">Entrada</th>
              <th class="num">Salida</th>
              <th class="num">Horas</th>
              <th class="num">Pago</th>
              <th class="num">Video</th>
              <th class="num">Playera</th>
              <th class="num">Tarde</th>
              <th>Notas</th>
              <th class="num">Acción</th>
            </tr>
          </thead>
          <tbody id="registroBody"></tbody>
        </table>
      </div>
    </section>

    <footer class="footer">
      <div>
        Hecho para <strong>La Bonita</strong> · Nómina simple y clara ✨
      </div>
      <div class="muted">
        Tip: Los datos se guardan en esta compu/cel. Si cambias de navegador, no se pasan.
      </div>
    </footer>
  </main>

  
<script>
  // Seed inicial (Febrero 2026 · 1-15) — generado por ChatGPT
  (function(){
    const key = "lb_nomina_records_v1";
    try {
      const existing = JSON.parse(localStorage.getItem(key) || "[]");
      if(Array.isArray(existing) && existing.length > 0) return;
      const seed = [{"id": "b802a313-c345-44df-b481-ff2168f3d4c0", "fecha": "2026-02-01", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "a95aa474-48d7-48c0-b747-a1702710501b", "fecha": "2026-02-01", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "978d6f3a-e590-4194-83be-3acbc03b5eb6", "fecha": "2026-02-02", "empleada": "Lupita", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "3b7e2613-9771-4a7f-8fec-9cf00efaa34b", "fecha": "2026-02-02", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "5e788276-f0b7-4702-95a8-2ac9831b5a1a", "fecha": "2026-02-02", "empleada": "Angelica", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "5157a855-76f3-4173-9b2a-95cb92de356a", "fecha": "2026-02-02", "empleada": "Lisa", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "7ca506c3-68da-47f4-a186-e6bdcbd27e19", "fecha": "2026-02-03", "empleada": "Lupita", "entrada": "16:00", "salida": "23:00", "video": false, "playera": false, "notas": ""}, {"id": "d65c069c-4e3b-4bba-b56e-b9e5312d5669", "fecha": "2026-02-03", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "d0dbf74b-7715-47ff-a2c2-29e683417a52", "fecha": "2026-02-03", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "d95f9d7b-86b9-4e2a-94a8-1a30db678bd0", "fecha": "2026-02-03", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "767b2b62-d4f3-46d2-b2a5-1ba43ff7dc67", "fecha": "2026-02-04", "empleada": "Lupita", "entrada": "16:00", "salida": "22:00", "video": false, "playera": false, "notas": ""}, {"id": "56be941b-75cb-4a19-b5dd-03a07dc3bba1", "fecha": "2026-02-04", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "1f501a56-2d0f-43f9-9290-a371675bab1c", "fecha": "2026-02-04", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "c1314c50-1af6-4420-90a3-1c9100f31508", "fecha": "2026-02-04", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "b70f1779-f572-4423-a3b2-a30c1380b04c", "fecha": "2026-02-05", "empleada": "Lupita", "entrada": "16:00", "salida": "22:00", "video": false, "playera": false, "notas": ""}, {"id": "b9a53f81-0f71-4a1c-bd27-db8d507ce252", "fecha": "2026-02-05", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "cc03c8bc-7b7a-4034-894c-7f2f6025e342", "fecha": "2026-02-05", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "b92b9459-0dda-4a2b-afec-9a3b5ed19e19", "fecha": "2026-02-05", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "39aa4904-11e0-4749-a97c-067d30c9c5e1", "fecha": "2026-02-06", "empleada": "Lupita", "entrada": "16:00", "salida": "22:15", "video": false, "playera": false, "notas": ""}, {"id": "c5541384-62d3-4f05-b9c8-8acff6f775bf", "fecha": "2026-02-06", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "ba8f591e-0c8b-44f8-9416-95983d5ffdb1", "fecha": "2026-02-06", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "c73cc903-6190-4b8f-a23b-fa21ba118057", "fecha": "2026-02-06", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "2cf4bc53-e27c-4c46-be36-49613824b1c1", "fecha": "2026-02-07", "empleada": "Lupita", "entrada": "16:00", "salida": "20:30", "video": false, "playera": false, "notas": ""}, {"id": "36dbfc2f-3770-41fc-b4ba-38852d1033e5", "fecha": "2026-02-07", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "1f1cfe00-dd43-422e-8bcd-e2bf9f423af5", "fecha": "2026-02-07", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "412e87eb-675d-4be4-ba45-9be8ed981555", "fecha": "2026-02-07", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "cfb6150f-9928-46fb-8841-d0446902b5cc", "fecha": "2026-02-08", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "952dbbb3-43a4-49ab-9edd-acb048008b60", "fecha": "2026-02-08", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "d05c7e3a-414c-4b15-8693-c732818a5e12", "fecha": "2026-02-08", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "1cfa0024-49d7-4240-ae7e-145a5a2ecf64", "fecha": "2026-02-09", "empleada": "Lupita", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "bc78cacf-1b69-4299-8261-9f14b4022e5b", "fecha": "2026-02-09", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "ba82d6be-996f-46c6-9a8b-fdaf840a777d", "fecha": "2026-02-09", "empleada": "Angelica", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "cac13bd0-d196-4b0f-b945-92e77879da94", "fecha": "2026-02-09", "empleada": "Lisa", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "fa23db4b-c10f-4114-b4f1-cbd824a811a3", "fecha": "2026-02-10", "empleada": "Lupita", "entrada": "16:00", "salida": "22:30", "video": false, "playera": false, "notas": ""}, {"id": "647181ae-0704-4f40-b01f-bd30de7de023", "fecha": "2026-02-10", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "4025a72f-1ab4-4e66-a236-6293520f10a2", "fecha": "2026-02-10", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "d70d0b42-27c8-416b-811c-02289517b0ce", "fecha": "2026-02-10", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "a51376cf-ec96-4dc3-b005-2d132d645844", "fecha": "2026-02-11", "empleada": "Lupita", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "3ef90357-5bce-4577-8394-3fe9417aa60c", "fecha": "2026-02-11", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "b1724ecf-d682-45a4-89f2-cb8b46863c40", "fecha": "2026-02-11", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "873fcd5e-9d70-41dd-8006-5cabc15f20ea", "fecha": "2026-02-11", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "dcb33e1c-dfdf-413e-b020-39fe31b48b02", "fecha": "2026-02-12", "empleada": "Lupita", "entrada": "16:00", "salida": "21:45", "video": false, "playera": false, "notas": ""}, {"id": "53a1820d-8bf1-4e95-aadc-3dd07a9d80c5", "fecha": "2026-02-12", "empleada": "Paulina", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "c080f0eb-a083-49e6-aba2-6ee58329893d", "fecha": "2026-02-12", "empleada": "Angelica", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "82ef55b6-efef-4233-bd3a-9e4103391a7f", "fecha": "2026-02-12", "empleada": "Lisa", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "7ce8c7d8-b327-4cef-8b94-d168b0ef7ac2", "fecha": "2026-02-13", "empleada": "Lupita", "entrada": "16:00", "salida": "21:45", "video": false, "playera": false, "notas": ""}, {"id": "0e7c3a54-0d44-49a9-abfe-82305d1c741f", "fecha": "2026-02-13", "empleada": "Paulina", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "931a74e1-cb7f-485a-9194-8634ff899696", "fecha": "2026-02-13", "empleada": "Angelica", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "21bdae3c-9c77-43c6-9fcb-b05107802302", "fecha": "2026-02-13", "empleada": "Lisa", "entrada": "16:00", "salida": "21:30", "video": false, "playera": false, "notas": ""}, {"id": "a0989f72-9048-40a9-be4f-4ceacf8dd9dd", "fecha": "2026-02-14", "empleada": "Lupita", "entrada": "16:00", "salida": "22:30", "video": false, "playera": false, "notas": ""}, {"id": "16f4d2f0-4f20-461f-bf1b-3d5437aed24c", "fecha": "2026-02-14", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "48747c6e-4f9c-47f2-a01f-25cbbe8c3a3d", "fecha": "2026-02-14", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "2b4f0bbe-494b-48b9-a219-2a8bf452dcfd", "fecha": "2026-02-14", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}, {"id": "550bd2a9-a1e2-419e-91d0-9ed2e41eae3a", "fecha": "2026-02-15", "empleada": "Lupita", "entrada": "16:00", "salida": "20:30", "video": false, "playera": false, "notas": ""}, {"id": "c2d619ac-36d8-48dc-82b3-853382c25212", "fecha": "2026-02-15", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "video": false, "playera": false, "notas": ""}, {"id": "0b08082e-0387-4d29-9e21-bcd419819b05", "fecha": "2026-02-15", "empleada": "Angelica", "entrada": "16:00", "salida": "19:00", "video": false, "playera": false, "notas": ""}, {"id": "58622f04-0233-4697-9584-a15efec8086f", "fecha": "2026-02-15", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "video": false, "playera": false, "notas": ""}];
      localStorage.setItem(key, JSON.stringify(seed));
    } catch(e) {}
  })();
</script>


<script>
  (function(){
    const key = "lb_nomina_bonos_v1";
    try {
      const existing = JSON.parse(localStorage.getItem(key) || "null");
      if(existing && typeof existing === "object") return;
      localStorage.setItem(key, JSON.stringify({"Lupita": true, "Paulina": false, "Angelica": false, "Lisa": false}));
    } catch(e) {}
  })();
</script>

  <script src="https://cdn.jsdelivr.net/npm/jspdf@2.5.1/dist/jspdf.umd.min.js"></script>

<script>
  // Seed inicial (Febrero 2026 · 1-15) — generado por ChatGPT
  (function(){
    const key = "lb_nomina_records_v1";
    try {
      const existing = JSON.parse(localStorage.getItem(key) || "[]");
      if(Array.isArray(existing) && existing.length > 0) return;
      const seed = [{"id": "375b9ac0-314e-4546-bf6a-c8f169c7b66d", "fecha": "2026-02-01", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "7e956bc5-d9f5-4940-9858-74f30cd2fcbf", "fecha": "2026-02-01", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b7b91cc8-32f6-42e8-9f46-9adcdd1e9740", "fecha": "2026-02-02", "empleada": "Lupita", "entrada": "14:00", "salida": "18:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "3117d8b5-4db7-4afa-a358-3a2a19191d75", "fecha": "2026-02-02", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "cc65bec2-bc28-451f-9f6e-71f7d982c91e", "fecha": "2026-02-02", "empleada": "Angelica", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "fb5c685c-d422-4619-ae77-3c30f1fe7e65", "fecha": "2026-02-02", "empleada": "Lisa", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "5a62e1b4-a074-4191-89f2-eeb4961ede6e", "fecha": "2026-02-03", "empleada": "Lupita", "entrada": "14:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b3221a2f-94f2-4ca8-9e4a-b470aaaeac54", "fecha": "2026-02-03", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b3e28cc7-434b-4d7e-a594-fb1bca240a1a", "fecha": "2026-02-03", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "bdc6be5f-acd0-430a-934b-d2b359b18364", "fecha": "2026-02-03", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "941f6b67-7efc-46a9-851d-400cf3adf731", "fecha": "2026-02-04", "empleada": "Lupita", "entrada": "14:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "613b85a2-85bd-4b7e-9342-dc3eb2065609", "fecha": "2026-02-04", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "84481906-c7e1-4fd5-a6af-1178f48dbb4e", "fecha": "2026-02-04", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "3e77f484-87f0-4c67-87d9-fa35fb266fdd", "fecha": "2026-02-04", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b32d08cb-dbd5-43b5-95f4-5ad3c1db7589", "fecha": "2026-02-05", "empleada": "Lupita", "entrada": "14:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a00ba434-66ee-4113-9a31-2b441e5adb78", "fecha": "2026-02-05", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "efa3b3bd-d1c8-45e1-99ac-68355687ba54", "fecha": "2026-02-05", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a1b8c7d3-e9f0-44c2-ad13-e62a3c50e28b", "fecha": "2026-02-05", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "744df61b-2cac-428c-9719-9078a0b72bec", "fecha": "2026-02-06", "empleada": "Lupita", "entrada": "14:00", "salida": "20:15", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "ee8d1c1a-a719-4868-81ce-6bc253bd60ba", "fecha": "2026-02-06", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "cf20136e-5111-48a3-98bd-1db882725a41", "fecha": "2026-02-06", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "fa621aab-e85c-4b67-8e7f-62476b00658e", "fecha": "2026-02-06", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "7ee46c5f-48c8-43f2-90e3-18e2d51f3a0b", "fecha": "2026-02-07", "empleada": "Lupita", "entrada": "14:00", "salida": "18:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "d86c18d9-9ef2-4c14-aa58-7ebadc99309f", "fecha": "2026-02-07", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "e27b5367-0b43-4f40-bd5e-01585bdc7eaf", "fecha": "2026-02-07", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "6d7d86d0-72c7-4190-ba06-9966dfa9d847", "fecha": "2026-02-07", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "144ab68a-4370-419b-8b74-a883e3a7afb8", "fecha": "2026-02-08", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b74c22a2-99c1-4c4e-aac9-bea7df20e1c9", "fecha": "2026-02-08", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a79b5d82-9502-45dd-a98d-5667b9ea9075", "fecha": "2026-02-08", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "7983cef1-7295-4e18-be9b-5adb6d9d49d2", "fecha": "2026-02-09", "empleada": "Lupita", "entrada": "14:00", "salida": "18:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "ed293da7-5cb6-4cdf-a700-d9a758661a63", "fecha": "2026-02-09", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a1f434aa-979a-4948-ae6b-d4f2529ee081", "fecha": "2026-02-09", "empleada": "Angelica", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "ff67e6fb-b613-46b6-a21f-0bd16e7078d4", "fecha": "2026-02-09", "empleada": "Lisa", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "8eb5d19e-3a20-4300-8554-484941c70ee8", "fecha": "2026-02-10", "empleada": "Lupita", "entrada": "14:00", "salida": "20:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "2056077a-3800-47c1-98f6-1431a0662cad", "fecha": "2026-02-10", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "3371bbff-05bf-4f31-8979-50a4190666b3", "fecha": "2026-02-10", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "0bfa6879-f7f7-4f55-b352-067a7f7e2427", "fecha": "2026-02-10", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "35de9ec1-6104-47db-98f4-42155e226ae0", "fecha": "2026-02-11", "empleada": "Lupita", "entrada": "14:00", "salida": "19:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "44f5dae2-35f1-499e-a566-281d88182780", "fecha": "2026-02-11", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "7488af74-8b65-46e2-8f39-54c08b32efce", "fecha": "2026-02-11", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "97f3723a-c374-4f15-aeaa-16c830d30163", "fecha": "2026-02-11", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "b2e46a56-21ed-47c3-a694-2dd35480bb50", "fecha": "2026-02-12", "empleada": "Lupita", "entrada": "14:00", "salida": "19:45", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a163aa61-3a17-4de3-9840-946bcf1667fc", "fecha": "2026-02-12", "empleada": "Paulina", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "34b40c98-c580-4393-ac87-70156daa2067", "fecha": "2026-02-12", "empleada": "Angelica", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "9c3cfb3a-ed4d-4e48-9953-79ca07fdbeaf", "fecha": "2026-02-12", "empleada": "Lisa", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "fe8e27f7-e52b-4be2-aaa8-ff35eedd3cfe", "fecha": "2026-02-13", "empleada": "Lupita", "entrada": "14:00", "salida": "19:45", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "72713307-9a16-4719-8d3c-0d7cadb4d93e", "fecha": "2026-02-13", "empleada": "Paulina", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "85cc6938-fc3a-4dff-892d-6032e1303ed5", "fecha": "2026-02-13", "empleada": "Angelica", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "12298c98-1d6b-43e5-b971-5b5e5019e5b6", "fecha": "2026-02-13", "empleada": "Lisa", "entrada": "16:00", "salida": "21:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "13ac7a6a-13f9-4750-9bbf-3f6a38a5ea95", "fecha": "2026-02-14", "empleada": "Lupita", "entrada": "14:00", "salida": "20:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "d38ad140-e9c5-4a6f-bcb9-f71afc610486", "fecha": "2026-02-14", "empleada": "Paulina", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "a3e0c081-97c3-455a-aeea-99c267789331", "fecha": "2026-02-14", "empleada": "Angelica", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "1c52eebd-c5c7-436d-a2da-3b181344f9a3", "fecha": "2026-02-14", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "5bda787a-5483-4fac-951c-13200829d557", "fecha": "2026-02-15", "empleada": "Lupita", "entrada": "14:00", "salida": "18:30", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "96cfffea-8e42-42be-8fc7-66bff0cf7f7e", "fecha": "2026-02-15", "empleada": "Paulina", "entrada": "16:00", "salida": "20:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "3bb2ce2d-833e-4569-89be-b95b16648027", "fecha": "2026-02-15", "empleada": "Angelica", "entrada": "16:00", "salida": "19:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}, {"id": "f61a59cc-14e5-4502-a54c-48ec46a57686", "fecha": "2026-02-15", "empleada": "Lisa", "entrada": "16:00", "salida": "21:00", "videos": 0, "playeraAplicar": false, "playeraCosto": 0, "tarde": false, "notas": ""}];
      localStorage.setItem(key, JSON.stringify(seed));
    } catch(e) {}
  })();
</script>


<script>
  (function(){
    const key = "lb_nomina_bonos_v1";
    try {
      const existing = JSON.parse(localStorage.getItem(key) || "null");
      if(existing && typeof existing === "object") return;
      localStorage.setItem(key, JSON.stringify({"Lupita": true, "Paulina": false, "Angelica": false, "Lisa": false}));
    } catch(e) {}
  })();
</script>


<script>
  (function(){
    const key = "lb_nomina_bonos_amt_v1";
    try {
      const existing = JSON.parse(localStorage.getItem(key) || "null");
      if(existing && typeof existing === "object") return;
      localStorage.setItem(key, JSON.stringify({"Lupita": 50, "Paulina": 50, "Angelica": 50, "Lisa": 50}));
    } catch(e) {}
  })();
</script>

  <script>
// Nómina La Bonita — app sin backend (localStorage)

const EMPLEADAS = ["Lupita", "Paulina", "Angelica", "Lisa"];

const CONFIG = {
  pagoPorHora: 40,
  pagoPorVideo: 20,
  bonoPuntualidadQuincena: 50,
  descuentoPlayera: 25,
  horasLunesPagado: 4,
};

const LS_RECORDS = "lb_nomina_records_v1";
const LS_BONOS = "lb_nomina_bonos_v1";
const LS_BONOS_AMT = "lb_nomina_bonos_amt_v1";
const LS_PLAYERA_PLAN = "lb_nomina_playera_plan_v1";

function $(id){ return document.getElementById(id); }

function toISODate(d){
  const yyyy = d.getFullYear();
  const mm = String(d.getMonth()+1).padStart(2,"0");
  const dd = String(d.getDate()).padStart(2,"0");
  return `${yyyy}-${mm}-${dd}`;
}

function parseISODate(s){
  const [y,m,d] = s.split("-").map(Number);
  return new Date(y, m-1, d);
}

function endOfMonth(date){
  return new Date(date.getFullYear(), date.getMonth()+1, 0);
}

function minutesFromHHMM(hhmm){
  if(!hhmm) return null;
  const [h,m] = hhmm.split(":").map(Number);
  if(Number.isNaN(h) || Number.isNaN(m)) return null;
  return h*60 + m;
}

function roundToQuarterHours(minutes){
  if(minutes == null || minutes <= 0) return 0;
  const floored = Math.floor(minutes/15)*15; // 0–14 no cuenta
  return floored/60;
}

function currency(n){
  return Number(n||0).toLocaleString("es-MX", {style:"currency", currency:"MXN", minimumFractionDigits:2});
}

function daysBetweenInclusive(start, end){
  const a = new Date(start); const b = new Date(end);
  a.setHours(0,0,0,0); b.setHours(0,0,0,0);
  const days = Math.floor((b-a)/(1000*60*60*24));
  return days+1;
}

function countMondaysInclusive(start, end){
  const total = daysBetweenInclusive(start,end);
  let c=0;
  for(let i=0;i<total;i++){
    const d = new Date(start);
    d.setDate(d.getDate()+i);
    if(d.getDay()===1) c++;
  }
  return c;
}

function getQuincenaRange(year, monthIndex, mode){
  // monthIndex 0-11
  if(mode === "1-15"){
    return { start: new Date(year, monthIndex, 1), end: new Date(year, monthIndex, 15) };
  }
  const start = new Date(year, monthIndex, 16);
  return { start, end: endOfMonth(start) };
}

function loadRecords(){
  try{ return JSON.parse(localStorage.getItem(LS_RECORDS) || "[]"); }
  catch{ return []; }
}

function saveRecords(records){
  localStorage.setItem(LS_RECORDS, JSON.stringify(records));
}

function loadBonos(){
  const base = { Lupita:true, Paulina:false, Angelica:false, Lisa:false };
  try{ return {...base, ...(JSON.parse(localStorage.getItem(LS_BONOS) || "{}"))}; }
  catch{ return base; }
}

function saveBonos(bonos){
  localStorage.setItem(LS_BONOS, JSON.stringify(bonos));
}

function loadBonosAmt(){
  const base = { Lupita:50, Paulina:50, Angelica:50, Lisa:50 };
  try{ return {...base, ...(JSON.parse(localStorage.getItem(LS_BONOS_AMT) || "{}"))}; }
  catch{ return base; }
}

function saveBonosAmt(bonosAmt){
  localStorage.setItem(LS_BONOS_AMT, JSON.stringify(bonosAmt));
}

function loadPlayeraPlan(){
  const base = {};
  EMPLEADAS.forEach(n=>{
    base[n] = { costoTotal: 0, mitadEmpleado: 0, saldoEmpleado: 0 };
  });
  try{
    const saved = JSON.parse(localStorage.getItem(LS_PLAYERA_PLAN) || "{}");
    const out = { ...base };
    Object.keys(out).forEach(n=>{
      if(saved[n]){
        out[n] = { ...out[n], ...saved[n] };
      }
    });
    return out;
  }catch{
    return base;
  }
}

function savePlayeraPlan(plan){
  localStorage.setItem(LS_PLAYERA_PLAN, JSON.stringify(plan));
}

function computeRecord(r){
  const inMin = minutesFromHHMM(r.entrada);
  const outMin = minutesFromHHMM(r.salida);
  let workedMin = 0;
  if(inMin != null && outMin != null){
    workedMin = outMin - inMin;
    // si se cruzara medianoche (raro), lo ajustamos
    if(workedMin < 0) workedMin += 24*60;
  }
  const horas = roundToQuarterHours(workedMin);
  const pagoHoras = horas * CONFIG.pagoPorHora;
  const pagoVideo = r.video ? CONFIG.pagoPorVideo : 0;
  const descPlayera = r.playera ? CONFIG.descuentoPlayera : 0;
  const totalDia = pagoHoras + pagoVideo - descPlayera;

  return { workedMin, horas, pagoHoras, pagoVideo, descPlayera, totalDia };
}

function buildReciboSelect(){
  const sel = $("reciboEmpleado");
  if(!sel) return;
  sel.innerHTML = "";
  EMPLEADAS.forEach(n=>{
    const opt = document.createElement("option");
    opt.value = n;
    opt.textContent = n;
    sel.appendChild(opt);
  });
}

function buildBonosUI(bonos, bonosAmt){
  const wrap = $("bonosUI");
  wrap.innerHTML = "";

  EMPLEADAS.forEach((name)=>{
    const row = document.createElement("div");
    row.className = "bonoRow";

    const left = document.createElement("div");
    left.className = "name";
    left.textContent = name;

    const right = document.createElement("div");
    right.className = "toggle";

    // Switch Sí/No
    const cb = document.createElement("input");
    cb.type = "checkbox";
    cb.checked = name === "Lupita" ? true : !!bonos[name];
    cb.disabled = name === "Lupita";

    const txt = document.createElement("span");
    txt.textContent = cb.checked ? "Sí" : "No";

    cb.addEventListener("change", ()=>{
      bonos[name] = cb.checked;
      saveBonos(bonos);
      render();
    });

    // Amount
    const amt = document.createElement("input");
    amt.type = "number";
    amt.min = "0";
    amt.step = "1";
    amt.value = String(bonosAmt[name] ?? 50);
    amt.style.width = "92px";
    amt.style.height = "34px";
    amt.style.borderRadius = "12px";
    amt.style.border = "1px solid rgba(90,59,46,.14)";
    amt.style.padding = "0 10px";
    amt.style.fontWeight = "900";
    amt.title = "Monto del bono para esta quincena";

    amt.addEventListener("input", ()=>{
      const v = Number(amt.value || 0);
      bonosAmt[name] = v;
      saveBonosAmt(bonosAmt);
      render();
    });

    const peso = document.createElement("span");
    peso.textContent = "$";
    peso.style.fontWeight = "900";
    peso.style.color = "#5A3B2E";

    right.appendChild(cb);
    right.appendChild(txt);

    // Lupita: bono siempre, pero monto editable
    const amtWrap = document.createElement("div");
    amtWrap.style.display = "flex";
    amtWrap.style.alignItems = "center";
    amtWrap.style.gap = "6px";
    amtWrap.style.marginLeft = "10px";
    amtWrap.appendChild(peso);
    amtWrap.appendChild(amt);

    row.appendChild(left);
    row.appendChild(right);
    row.appendChild(amtWrap);

    wrap.appendChild(row);
  });
}

function renderRegistro(records){
  const body = $("registroBody");
  body.innerHTML = "";

  const sorted = [...records].sort((a,b)=> a.fecha < b.fecha ? 1 : -1);

  sorted.forEach((r)=>{
    const c = computeRecord(r);
    const tr = document.createElement("tr");

    const cells = [
      r.fecha,
      r.empleada,
      r.entrada,
      r.salida,
      c.horas.toFixed(2),
      currency(c.pagoHoras),
      r.video ? "Sí" : "No",
      r.playera ? "Sí" : "No",
      r.notas || "",
    ];

    cells.forEach((val, idx)=>{
      const td = document.createElement("td");
      td.textContent = val;
      if([2,3,4,5,6,7].includes(idx)) td.className = "num";
      tr.appendChild(td);
    });

    const tdAction = document.createElement("td");
    tdAction.className = "num";

    const btnEdit = document.createElement("button");
    btnEdit.className = "iconBtn";
    btnEdit.textContent = "Editar";
    btnEdit.style.marginRight = "8px";
    btnEdit.addEventListener("click", ()=>{
      // Cargar datos al formulario para editar
      window.__LB_EDIT_ID__ = r.id;
      $("fecha").value = r.fecha;
      $("empleada").value = r.empleada;
      $("entrada").value = r.entrada;
      $("salida").value = r.salida;
      $("videos").value = Number(r.videos || 0);
      $("playeraAplicar").checked = !!r.playeraAplicar;
      $("playeraCosto").value = Number(r.playeraCosto || 0);
      $("notas").value = r.notas || "";
      previewFromForm();
      window.scrollTo({ top: 0, behavior: "smooth" });
      $("btnAdd").textContent = "Guardar cambios";
      $("btnAdd").classList.add("btnWarn");
    });

    const btn = document.createElement("button");
    btn.className = "iconBtn iconBtnDanger";
    btn.textContent = "Eliminar";
    btn.addEventListener("click", ()=>{
      const ok = confirm(`¿Eliminar el registro de ${r.empleada} del ${r.fecha}?`);
      if(!ok) return;
      const next = records.filter(x=> x.id !== r.id);
      saveRecords(next);
      render();
    });

    tdAction.appendChild(btnEdit);
    tdAction.appendChild(btn);
    tr.appendChild(tdAction);

    body.appendChild(tr);
  });
}

function renderNomina(records, bonos, bonosAmt){
  const mesVal = $("mes").value; // YYYY-MM
  const mode = $("quincena").value;

  if(!mesVal){
    $("nominaBody").innerHTML = "";
    $("rangeText").textContent = "Selecciona el mes";
    $("totalNomina").textContent = currency(0);
    $("totalVideos").textContent = currency(0);
    $("totalPlayeras").textContent = currency(0);
    return;
  }

  const [y, m] = mesVal.split("-").map(Number);
  const range = getQuincenaRange(y, m-1, mode);
  const start = range.start.getTime();
  const end = range.end.getTime();

  $("rangeText").textContent = `Periodo: ${toISODate(range.start)} → ${toISODate(range.end)}`;

  const inRange = records.filter((r)=>{
    const t = parseISODate(r.fecha).getTime();
    return t>=start && t<=end;
  });

  const mondays = countMondaysInclusive(range.start, range.end);

  let totalNomina = 0;
  let totalVideos = 0;
  let totalPlayeras = 0;

  const body = $("nominaBody");
  body.innerHTML = "";

  EMPLEADAS.forEach((name)=>{
    const rows = inRange.filter(r=> r.empleada === name);

    const horas = rows.reduce((acc, r)=> acc + computeRecord(r).horas, 0);
    const pagoHoras = horas * CONFIG.pagoPorHora;

    const horasLunes = mondays * CONFIG.horasLunesPagado;
    const pagoLunes = horasLunes * CONFIG.pagoPorHora;

    const videos = rows.reduce((acc, r)=> acc + (r.video?1:0), 0);
    const pagoVideos = videos * CONFIG.pagoPorVideo;

    const playeras = rows.reduce((acc, r)=> acc + (r.playera?1:0), 0);
    const descPlayera = playeras * CONFIG.descuentoPlayera;

    const amt = Number((bonosAmt && bonosAmt[name] != null) ? bonosAmt[name] : CONFIG.bonoPuntualidadQuincena);
    const bono = (name === "Lupita") ? amt : (bonos[name] ? amt : 0);

    const total = (pagoHoras + pagoLunes) + pagoVideos + bono - descPlayera;

    totalNomina += total;
    totalVideos += pagoVideos;
    totalPlayeras += descPlayera;

    const tr = document.createElement("tr");

    const cells = [
      name,
      horas.toFixed(2),
      `${mondays} lunes`,
      currency(pagoHoras + pagoLunes),
      videos,
      currency(pagoVideos),
      currency(descPlayera),
      currency(bono),
      currency(total),
    ];

    cells.forEach((val, idx)=>{
      const td = document.createElement("td");
      td.textContent = val;
      if(idx>=1) td.className = "num";
      tr.appendChild(td);
    });

    body.appendChild(tr);
  });

  $("totalNomina").textContent = currency(totalNomina);
  $("totalVideos").textContent = currency(totalVideos);
  $("totalPlayeras").textContent = currency(totalPlayeras);
}

function exportRegistroCSV(records){
  const rows = [
    ["FECHA","EMPLEADA","ENTRADA","SALIDA","HORAS","PAGO_HORAS","VIDEO","PLAYERA","NOTAS"],
  ];

  records
    .slice()
    .sort((a,b)=> a.fecha > b.fecha ? 1 : -1)
    .forEach((r)=>{
      const c = computeRecord(r);
      rows.push([
        r.fecha,
        r.empleada,
        r.entrada,
        r.salida,
        c.horas.toFixed(2),
        c.pagoHoras.toFixed(2),
        String(Number(r.videos || 0)),
        (r.playeraAplicar ? "SI" : "NO"),
        String(Number(r.playeraCosto || 0)),
        r.tarde ? "SI" : "NO",
        r.notas || "",
      ]);
    });

  downloadCSV(`registro_la_bonita_${toISODate(new Date())}.csv`, rows);
}

function exportNominaCSV(records, bonos, bonosAmt, playeraPlan){
  const mesVal = $("mes").value;
  const mode = $("quincena").value;
  if(!mesVal){
    alert("Selecciona el mes primero.");
    return;
  }

  const [y, m] = mesVal.split("-").map(Number);
  const range = getQuincenaRange(y, m-1, mode);
  const start = range.start.getTime();
  const end = range.end.getTime();

  const inRange = records.filter((r)=>{
    const t = parseISODate(r.fecha).getTime();
    return t>=start && t<=end;
  });

  const mondays = countMondaysInclusive(range.start, range.end);

  const rows = [
    [
      "EMPLEADA","HORAS","LUNES","PAGO_HORAS","VIDEOS","PAGO_VIDEOS","DESCUENTO_PLAYERA","BONO","TOTAL"
    ]
  ];

  EMPLEADAS.forEach((name)=>{
    const rowsEmp = inRange.filter(r=> r.empleada === name);
    const horas = rowsEmp.reduce((acc, r)=> acc + computeRecord(r).horas, 0);
    const pagoHoras = horas * CONFIG.pagoPorHora;
    const horasLunes = mondays * CONFIG.horasLunesPagado;
    const pagoLunes = horasLunes * CONFIG.pagoPorHora;
    const videos = rowsEmp.reduce((acc, r)=> acc + (r.video?1:0), 0);
    const pagoVideos = videos * CONFIG.pagoPorVideo;
    const playeras = rowsEmp.reduce((acc, r)=> acc + (r.playera?1:0), 0);
    const descPlayera = playeras * CONFIG.descuentoPlayera;
    const amt = Number((bonosAmt && bonosAmt[name] != null) ? bonosAmt[name] : CONFIG.bonoPuntualidadQuincena);
    const bono = (name === "Lupita") ? amt : (bonos[name] ? amt : 0);
    const total = (pagoHoras + pagoLunes) + pagoVideos + bono - descPlayera;

    rows.push([
      name,
      horas.toFixed(2),
      mondays,
      (pagoHoras+pagoLunes).toFixed(2),
      videos,
      pagoVideos.toFixed(2),
      descPlayera.toFixed(2),
      bono.toFixed(2),
      total.toFixed(2),
    ]);
  });

  downloadCSV(`nomina_la_bonita_${toISODate(range.start)}_${toISODate(range.end)}.csv`, rows);
}

function downloadCSV(filename, rows){
  const csv = rows.map(r=> r.map(cell=> {
    const s = String(cell ?? "");
    const escaped = s.replaceAll('"','""');
    return `"${escaped}"`;
  }).join(",")).join("\n");

  const blob = new Blob([csv], {type:"text/csv;charset=utf-8;"});
  const url = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = filename;
  document.body.appendChild(a);
  a.click();
  document.body.removeChild(a);
  URL.revokeObjectURL(url);
}

function previewFromForm(){
  const tmp = {
    fecha: $("fecha").value,
    empleada: $("empleada").value,
    entrada: $("entrada").value,
    salida: $("salida").value,
    videos: Number($("videos").value || 0),
    playeraAplicar: $("playeraAplicar").checked,
      playeraCosto: Number($("playeraCosto").value || 0),
    notas: $("notas").value.trim(),
  };

  const c = computeRecord(tmp);
  const txt = `Horas: ${c.horas.toFixed(2)} · Pago: ${currency(c.pagoHoras)} ${tmp.video?"· +video":""} ${tmp.playera?"· -playera":""}`;
  $("preview").textContent = txt;
}

function init(){
  // empleados
  const sel = $("empleada");
  EMPLEADAS.forEach((n)=>{
    const op = document.createElement("option");
    op.value = n; op.textContent = n;
    sel.appendChild(op);
  });

  // defaults
  $("fecha").value = toISODate(new Date());
  $("entrada").value = "16:00";
  $("salida").value = "20:00";

  // mes default
  const now = new Date();
  $("mes").value = `${now.getFullYear()}-${String(now.getMonth()+1).padStart(2,"0")}`;

  // listeners
  ["fecha","empleada","entrada","salida","notas"].forEach((id)=>{
    $(id).addEventListener("input", previewFromForm);
  });
  ["video","playera"].forEach((id)=>{
    $(id).addEventListener("change", previewFromForm);
  });

  $("btnAdd").addEventListener("click", ()=>{
    const editingId = window.__LB_EDIT_ID__ || null;

    const record = {
      id: editingId ? editingId : crypto.randomUUID(),
      fecha: $("fecha").value,
      empleada: $("empleada").value,
      entrada: $("entrada").value,
      salida: $("salida").value,
      videos: Number($("videos").value || 0),
      playeraAplicar: $("playeraAplicar").checked,
      playeraCosto: Number($("playeraCosto").value || 0),
      tarde: isLateByEntrada($("entrada").value),
      notas: $("notas").value.trim(),
    };

    if(!record.fecha || !record.empleada || !record.entrada || !record.salida){
      alert("Completa fecha, empleada, entrada y salida.");
      return;
    }

    const inMin = minutesFromHHMM(record.entrada);
    const outMin = minutesFromHHMM(record.salida);
    let diff = outMin - inMin;
    if(diff < 0) diff += 24*60;

    if(diff <= 0){
      alert("La hora de salida debe ser después de la entrada.");
      return;
    }

    const records = loadRecords();

    if(editingId){
      const idx = records.findIndex(x=> x.id === editingId);
      if(idx >= 0){
        records[idx] = record;
      }else{
        records.push(record);
      }
      window.__LB_EDIT_ID__ = null;
      $("btnAdd").textContent = "Guardar registro";
      $("btnAdd").classList.remove("btnWarn");
    }else{
      records.push(record);
    }

    saveRecords(records);

    // reset parcial
    $("videos").value = 0;
    $("playeraAplicar").checked = false;
    $("playeraCosto").value = 0;
        $("notas").value = "";

    render();
  });

  $("mes").addEventListener("change", render);
  $("quincena").addEventListener("change", render);

  $("btnExportRegistro").addEventListener("click", ()=>{
    exportRegistroCSV(loadRecords());
  });

  // Recibo PDF por empleada
  const btnPdf = $("btnReciboPDF");
  if(btnPdf){
    btnPdf.addEventListener("click", ()=>{
      const emp = $("reciboEmpleado").value;
      const bonos = loadBonos();
      const bonosAmt = loadBonosAmt();
      const playeraPlan = loadPlayeraPlan();
      const records = loadRecords();
      const range = getSelectedRange();
      const data = computeNominaForEmployee(emp, records, bonos, bonosAmt, playeraPlan, range);
      downloadReciboPDF(emp, data, range);
    });
  }


  $("btnExportNomina").addEventListener("click", ()=>{
    exportNominaCSV(loadRecords(), loadBonos(), loadBonosAmt(), loadPlayeraPlan());
  });

  $("btnReset").addEventListener("click", ()=>{
    const ok = confirm("¿Seguro? Esto borra TODO el historial guardado en esta computadora.");
    if(!ok) return;
    localStorage.removeItem(LS_RECORDS);
    localStorage.removeItem(LS_BONOS);
    window.__LB_EDIT_ID__ = null;
    $("btnAdd").textContent = "Guardar registro";
    $("btnAdd").classList.remove("btnWarn");
    render();
  });

  previewFromForm();
  render();
}

function render(){
  const records = loadRecords();
  const bonos = loadBonos();
  const bonosAmt = loadBonosAmt();

  // Lupita siempre sí
  bonos.Lupita = true;
  saveBonos(bonos);
  // Bonos monto: si no existe, se inicializa
  saveBonosAmt(bonosAmt);

  buildBonosUI(bonos, bonosAmt);
  renderRegistro(records);
  renderNomina(records, bonos, bonosAmt);
  previewFromForm();
}

init();

</script>
</body>
</html>
